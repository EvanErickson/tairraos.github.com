<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>22.0 目标Python2+3 - 《Python进阶》</title>
    <link rel="shortcut icon" href="../../statics/img/favicon.ico">
    <link rel="stylesheet" href="../../css/theme.css" type="text/css"/>
    <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css"/>
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../styles/print.css" rel="stylesheet">
    <link href="../../styles/website.css" rel="stylesheet">
    <script>
        var mkdocs_page_name = "22.0 目标Python2+3";
        var mkdocs_page_input_path = "TargetingPython2+3/README.md";
        var mkdocs_page_url = "/TargetingPython2+3/README/";
    </script>
    <script src="../../js/jquery-2.1.1.min.js"></script>
    <script src="../../js/modernizr-2.8.3.min.js"></script>
    <script type="text/javascript" src="../../js/highlight.pack.js"></script>
    <script src="../../js/theme.js"></script>
</head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
        <div class="wy-side-nav-search">
            <a href="../.." class="icon icon-home"> 《Python进阶》</a>
        </div>
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            <ul class="current">
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../..">前言</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../args_kwargs/README/">1.0 *args 和 **kwargs</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../args_kwargs/Usage_args/">1.1 *args 的用法</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../args_kwargs/Usage_kwargs/">1.2 **kwargs 的用法</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../args_kwargs/Using_args_and_kwargs_to_call_function/">1.3 使用 *args 和 **kwargs
                        来调用函数</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../args_kwargs/When_to_use/">1.4 什么时候使用它们</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Debugging/README/">2.0 调试 Debugging</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Generators/README/">3.0 生成器 Generators</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Generators/Iterable/">3.1 可迭代对象(Iterable)</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Generators/Iterator/">3.2 迭代器(Iterator)</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Generators/Iteration/">3.3 迭代(Iteration)</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Generators/Generators/">3.4 生成器(Generators)</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Map_Filter/README/">4.0 Map，Filter和Reduce</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Map_Filter/Map/">4.1 Map</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Map_Filter/Filter/">4.2 Filter</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Map_Filter/Reduce/">4.3 Reduce</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../set_data_structure/set_data_structure/">5.0 set 数据结构</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../ternary_operators/ternary_operators/">6.0 三元运算符</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/README/">7.0 装饰器</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/everything_is_object/">7.1 一切皆对象</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/def_func_in_func/">7.2 在函数中定义函数</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/return_func_in_func/">7.3 从函数中返回函数</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/func_as_argument/">7.4 将函数作为参数传给另一个函数</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/your_first_decorator/">7.5 你的第一个装饰器</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/use_cases/">7.5.1 使用场景</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/auth/">7.5.2 授权</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/logging/">7.5.3 日志</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/deco_with_args/">7.6 带参数的装饰器</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/nest_deco_in_func/">7.6.1 在函数中嵌入装饰器</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../decorators/deco_class/">7.6.2 装饰器类</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../global_return/README/">8.0 Global和Return</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../global_return/multiple_return_values/">8.1 多个return值</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Mutation/README/">9.0 对象变动 Mutation</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../slots_magic/README/">10.0 __slots__魔法</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../virtual_environment/virtual_environment/">11.0 虚拟环境</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../collections/collections/">12.0 容器 Collections</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Enumerate/Enumerate/">13.0 枚举 Enumerate</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../introspection/README/">14.0 对象自省</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../introspection/dir/">14.1 dir</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../introspection/type_and_id/">14.2 type和id</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../introspection/inspect/">14.3 inspect模块</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Comprehensions/README/">15.0 推导式 Comprehension</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Comprehensions/list-comprehensions/">15.1 列表推导式</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Comprehensions/dict-comprehensions/">15.2 字典推导式</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Comprehensions/set-comprehensions/">15.3 集合推导式</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../exception/README/">16.0 异常</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../exception/multiple_exception/">16.1 处理多个异常</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../exception/finally_clause/">16.2 finally从句</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../exception/try_else_clause/">16.3 try/else从句</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Lambdas/README/">17.0 lambda表达式</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Onelines/README/">18.0 一行式</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../for_else/README/">19.0 For - Else</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../for_else/else_clause/">19.1 else语句</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../c_extensions/README/">20.0 使用C扩展</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../c_extensions/ctypes/">20.1 CTypes</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../c_extensions/swig/">20.2 SWIG</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../c_extensions/python_c_api/">20.3 Python/C API</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../open_func/open_func/">21.0 open函数</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 current">
                    <a class="current" href="./">22.0 目标Python2+3</a>
                    <ul>
                        <li class="toctree-l3"><a href="#22-python23">22. 目标Python2+3</a></li>
                    </ul>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../Coroutines/README/">23.0 协程</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../func_caching/README/">24.0 函数缓存</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../func_caching/python_32/">24.1 Python 3.2+</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../func_caching/python_2/">24.2 Python 2+</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../context_managers/README/">25.0 上下文管理器</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../context_managers/implement_as_class/">25.1 基于类的实现</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../context_managers/handle_exception/">25.2 处理异常</a>
                </li>
                <li>
                <li>
                <li class="toctree-l1 ">
                    <a class="" href="../../context_managers/implement_as_generator/">25.3 基于生成器的实现</a>
                </li>
                <li>
            </ul>
        </div>
        &nbsp;
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
            <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
            <a href="../..">《Python进阶》</a>
        </nav>
        <div class="wy-nav-content">
            <div class="rst-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <ul class="wy-breadcrumbs">
                        <li><a href="http://docs.pythontab.com">在线手册</a> &raquo;</li>
                        <li><a href="../..">《Python进阶》</a> &raquo;</li>
                        <li>22.0 目标Python2+3</li>
                        <li class="wy-breadcrumbs-aside">
                            <a href="http://bbs.pythontab.com" target="_blank" class="icon icon-link"> Python论坛</a>
                        </li>
                    </ul>
                    <hr/>
                </div>
                <div role="main">
                    <div class="section">
                        <h1 id="22-python23">22. 目标Python2+3</h1>
                        <p>很多时候你可能希望你开发的程序能够同时兼容Python2+和Python3+。</p>
                        <p>
                            试想你有一个非常出名的Python模块被很多开发者使用着，但并不是所有人都只使用Python2或者Python3。这时候你有两个办法。第一个办法是开发两个模块，针对Python2一个，针对Python3一个。还有一个办法就是调整你现在的代码使其同时兼容Python2和Python3。</p>
                        <p>本节中，我将介绍一些技巧，让你的脚本同时兼容Python2和Python3。</p>
                        <p><strong>Future模块导入</strong></p>
                        <p>第一种也是最重要的方法，就是导入<code>__future__</code>模块。它可以帮你在Python2中导入Python3的功能。这有一组例子：</p>
                        <p>上下文管理器是Python2.6+引入的新特性，如果你想在Python2.5中使用它可以这样做：</p>
                        <pre><code class="python">from __future__ import with_statement
</code></pre>
                        <p>在Python3中<code>print</code>已经变为一个函数。如果你想在Python2中使用它可以通过<code>__future__</code>导入：</p>
                        <pre><code class="python">print
# Output:
from __future__ import print_function
print(print)
# Output: &lt;built-in function print&gt;
</code></pre>
                        <p><strong>模块重命名</strong></p>
                        <p>首先，告诉我你是如何在你的脚本中导入模块的。大多时候我们会这样做：</p>
                        <pre><code class="python">import foo
# or
from foo import bar
</code></pre>
                        <p>你知道么，其实你也可以这样做：</p>
                        <pre><code class="python">import foo as foo
</code></pre>
                        <p>这样做可以起到和上面代码同样的功能，但最重要的是它能让你的脚本同时兼容Python2和Python3。现在我们来看下面的代码：</p>
                        <pre><code class="python">try:
    import urllib.request as urllib_request  # for Python 3
except ImportError:
    import urllib2 as urllib_request  # for Python 2
</code></pre>
                        <p>让我来稍微解释一下上面的代码。<br/>
                            我们将模块导入代码包装在<code>try/except</code>语句中。我们是这样做是因为在Python 2中并没有<code>urllib.request</code>模块。这将引起一个<code>ImportError</code>异常。而在Python2中<code>urllib.request</code>的功能则是由<code>urllib2</code>提供的。所以,当我们试图在Python2中导入<code>urllib.request</code>模块的时候，一旦我们捕获到<code>ImportError</code>我们将通过导入<code>urllib2</code>模块来代替它。
                        </p>
                        <p>
                            最后，你要了解<code>as</code>关键字的作用。它将导入的模块映射到<code>urllib.request</code>，所以我们通过<code>urllib_request</code>这个别名就可以使用<code>urllib2</code>中的所有类和方法了。
                        </p>
                        <p><strong>过期的Python2内置功能</strong></p>
                        <p>
                            另一个需要了解的事情就是Python2中有12个内置功能在Python3中已经被移除了。要确保在Python2代码中不要出现这些功能来保证对Python3的兼容。这有一个强制让你放弃12内置功能的方法：</p>
                        <pre><code class="python">from future.builtins.disabled import *
</code></pre>
                        <p>现在，只要你尝试在Python3中使用这些被遗弃的模块时，就会抛出一个<code>NameError</code>异常如下：</p>
                        <pre><code class="python">from future.builtins.disabled import *
apply()
# Output: NameError: obsolete Python 2 builtin apply is disabled
</code></pre>
                        <p><strong>标准库向下兼容的外部支持</strong></p>
                        <p>有一些包在非官方的支持下为Python2提供了Python3的功能。例如，我们有：</p>
                        <ul>
                            <li>enum <code>pip install enum34</code></li>
                            <li>singledispatch <code>pip install singledispatch</code></li>
                            <li>pathlib <code>pip install pathlib</code></li>
                        </ul>
                        <p>想更多了解，在Python文档中有一个<a href="https://docs.python.org/3/howto/pyporting.html">全面的指南</a>可以帮助你让你的代码同时兼容Python2和Python3。
                        </p>
                    </div>
                </div>
                <footer>
                    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
                        <a href="../../Coroutines/README/" class="btn btn-neutral float-right" title="23.0 协程">Next
                            <span class="icon icon-circle-arrow-right"></span></a>
                        <a href="../../open_func/open_func/" class="btn btn-neutral" title="21.0 open函数"><span
                                class="icon icon-circle-arrow-left"></span> Previous</a>
                    </div>
                </footer>
            </div>
        </div>
    </section>
</div>
<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span><a href="../../open_func/open_func/" style="color: #fcfcfc;">Previous</a></span>
        <span style="margin-left: 15px"><a href="../../Coroutines/README/" style="color: #fcfcfc">Next</a></span>
    </span>
</div>
</body>
</html>
