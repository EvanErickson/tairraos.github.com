(function(){var b=document.getElementById("basket"),i=document.getElementById("title"),k=document.getElementById("report");if(!window.FileReader){b.innerHTML="你的浏览器太老了，换一个浏览器试试。";return}b.addEventListener("dragenter",c,false);b.addEventListener("dragover",c,false);b.addEventListener("dragleave",f,false);b.addEventListener("drop",a,false);document.title+=" by 小乐";i.innerHTML=document.title;b.innerHTML="把“待收明细报表_全部.xls”拖放到此处。";function f(){b.classList.remove("dragover")}function c(l){b.classList.add("dragover");l.stopPropagation();l.preventDefault()}function a(l){file=l.dataTransfer.files;l.stopPropagation();l.preventDefault();if(!file.length){b.innerHTML="文件拖放动作有问题，重试一次。";f();return}g(file[0])}function g(m){if(m.name.match(/\.xls$/)){var l=new FileReader();l.onload=function(p){var o=p.target.result;var n=XLSX.read(o,{type:"binary"});if(!n.Sheets["待收明细报表_全部"]){b.innerHTML="你拖放的xls不是微贷散标导出文件，重试一次。";return}h(n.Sheets["待收明细报表_全部"]);b.style.display="none"};l.readAsBinaryString(m)}else{b.innerHTML="你拖放的不是xls文件，重试一次。"}f()}function d(l){return Math.round(+l*100)/100}function j(l){return l.replace("-","年")+"月"}function h(x){var m=5,n=+x["!ref"].match(/H(\d+)/)[1],s=0,p={},o={},w={},t;for(var l=m;l<=n;l++){var q=x["B"+l].v.slice(0,-3),r=q.slice(0,-3),u=x["D"+l].v;o[q]=d((o[q]||0)+u);w[r]=d((w[r]||0)+u);p[q]=d((p[q]||0)+1);s=d(s+u)}t=x["B"+n].v;e({totalPay:s,monthPay:o,yearPay:w,lastPayDay:t,monthNum:p})}function e(m){var p=echarts.init(document.getElementById("chart"),"light"),s,q,t=[],r=[],o=0;for(s in m.yearPay){t.push({value:m.yearPay[s],name:s+"年 "+d(m.yearPay[s]/m.totalPay*100)+"%"})}q=0;for(s in m.monthPay){o=d(o+m.monthPay[s]);r.push({value:Math.floor(o/m.totalPay*100)+"%",name:"进度: "+d(o/m.totalPay*100)+"%",xAxis:q++,yAxis:m.monthPay[s]})}var n={title:{},tooltip:{},legend:{},xAxis:{splitNumber:Object.keys(m.monthPay).length,axisLabel:{interval:0},data:Object.keys(m.monthPay).map(function(u){return{value:u.match(/-01/)?u.slice(0,-3)+"年":u.slice(-2)+"月",textStyle:{fontSize:10}}})},yAxis:{},series:[{name:"月回款",type:"line",lineStyle:{color:"#600"},smooth:true,data:Object.values(m.monthPay)},{name:"月回款",type:"bar",markPoint:{symbol:"pin",data:r,symbolSize:[1,30],label:{color:"#333",fontSize:10},itemStyle:{color:"#fff",}},label:{show:true,position:"insideBottom",rotate:45,offset:[2,-8],fontSize:8},data:Object.values(m.monthPay)},{name:"年回款",type:"pie",radius:"40%",center:["70%","35%"],data:t}]};p.setOption(n);var l=["回款分析："];l.push("");l.push("待还总本金金额："+m.totalPay+"元");l.push("共有待执行合同："+Math.max.apply(Math,Object.values(m.monthNum))+"个");l.push("最后一笔回款时间："+m.lastPayDay.replace(/-(\d\d)-(\d\d)/,"年$1月$2日"));l.push("");for(s in m.yearPay){l.push(s+"年还款："+m.yearPay[s]+"元，占比"+d(m.yearPay[s]/m.totalPay*100)+"%")}l.push("");o=0;for(s in m.monthPay){o=d(o+m.monthPay[s]);l.push(j(s)+"还款："+m.monthPay[s]+"元("+d(m.monthPay[s]/m.totalPay*100)+"%)；"+"累计还款："+o+"元("+d(o/m.totalPay*100)+"%)；"+"执行合同数:"+m.monthNum[s]+"个")}k.innerHTML=l.join("<br>\n")}}());