(function(){var b=document.getElementById("basket"),i=document.getElementById("title"),k=document.getElementById("readme"),l=document.getElementById("report");if(!window.FileReader){b.innerHTML="你的浏览器太老了，换一个浏览器试试。";return}b.addEventListener("dragenter",c,false);b.addEventListener("dragover",c,false);b.addEventListener("dragleave",f,false);b.addEventListener("drop",a,false);document.title+=" by 小乐";i.innerHTML=document.title;k.innerHTML="把“待收明细报表_全部.xls”拖放到此处。";function f(){b.classList.remove("dragover")}function c(m){b.classList.add("dragover");m.stopPropagation();m.preventDefault()}function a(m){file=m.dataTransfer.files;m.stopPropagation();m.preventDefault();if(!file.length){b.innerHTML="文件拖放动作有问题，重试一次。";f();return}g(file[0])}function g(n){if(n.name.match(/\.xls$/)){var m=new FileReader();m.onload=function(q){var p=q.target.result;var o=XLSX.read(p,{type:"binary"});if(!o.Sheets["待收明细报表_全部"]){b.innerHTML="你拖放的xls不是微贷散标导出文件，重试一次。";return}h(o.Sheets["待收明细报表_全部"]);b.style.display="none"};m.readAsBinaryString(n)}else{b.innerHTML="你拖放的不是xls文件，重试一次。"}f()}function d(m){return Math.round(+m*100)/100}function j(m){return m.replace("-","年")+"月"}function h(z){var n=5,o=+z["!ref"].match(/H(\d+)/)[1],t=0,q={},p={},x={},u;for(var m=n;m<=o;m++){var r=z["B"+m].v.slice(-10).slice(0,-3),s=r.slice(0,-3),w=z["D"+m].v;p[r]=d((p[r]||0)+w);x[s]=d((x[s]||0)+w);q[r]=d((q[r]||0)+1);t=d(t+w)}u=z["B"+o].v;e({totalPay:t,monthPay:p,yearPay:x,lastPayDay:u,monthNum:q})}function e(n){var q=echarts.init(document.getElementById("chart"),"light"),t,r,u=[],s=[],p=0;for(t in n.yearPay){u.push({value:n.yearPay[t],name:t+"年 "+d(n.yearPay[t]/n.totalPay*100)+"%"})}r=0;for(t in n.monthPay){p=d(p+n.monthPay[t]);s.push({value:Math.floor(p/n.totalPay*100)+"%",name:"进度: "+d(p/n.totalPay*100)+"%",xAxis:r++,yAxis:n.monthPay[t]})}var o={title:{},tooltip:{},legend:{},xAxis:{splitNumber:Object.keys(n.monthPay).length,axisLabel:{interval:0},data:Object.keys(n.monthPay).map(function(v){return{value:v.match(/-01/)?v.slice(0,-3)+"年":v.slice(-2)+"月",textStyle:{fontSize:10}}})},yAxis:{},series:[{name:"月回款",type:"line",lineStyle:{color:"#600"},smooth:true,data:Object.values(n.monthPay)},{name:"月回款",type:"bar",markPoint:{symbol:"pin",data:s,symbolSize:[1,30],label:{color:"#333",fontSize:10},itemStyle:{color:"#fff",}},label:{show:true,position:"insideBottom",rotate:45,offset:[2,-8],fontSize:8},data:Object.values(n.monthPay)},{name:"年回款",type:"pie",radius:"40%",center:["70%","35%"],data:u}]};q.setOption(o);var m=["回款分析："];m.push("");m.push("待还总本金金额："+n.totalPay+"元");m.push("共有待执行合同："+Math.max.apply(Math,Object.values(n.monthNum))+"个");m.push("最后一笔回款时间："+n.lastPayDay.replace(/-(\d\d)-(\d\d)/,"年$1月$2日"));m.push("");for(t in n.yearPay){m.push(t+"年还款："+n.yearPay[t]+"元，占比"+d(n.yearPay[t]/n.totalPay*100)+"%")}m.push("");p=0;for(t in n.monthPay){p=d(p+n.monthPay[t]);m.push(j(t)+"还款："+n.monthPay[t]+"元("+d(n.monthPay[t]/n.totalPay*100)+"%)；"+"累计还款："+p+"元("+d(p/n.totalPay*100)+"%)；"+"执行合同数:"+n.monthNum[t]+"个")}l.innerHTML=m.join("<br>\n")}}());